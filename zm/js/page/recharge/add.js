define(["app","mui","vue"],function(a,e,f){new f({el:"#app",data:{amount:"",par:{tradeNo:"",payType:""},payChannel:{},orderInfo:{}},computed:{isValid:function(){return!!this.amount&&!!this.par.payType}},methods:{createOrder:function(){var b=this;a.showWaiting();b.par.tradeNo||a.post("api/Shop/CreateMBOrder",{amount:b.amount},function(a){b.par.tradeNo=a;b.pay()},function(){a.closeWaiting()})},pay:function(){var b=this,d=b.payChannel[b.par.payType];d.serviceReady?a.post("api/Shop/GetTradeSignInfo",b.par,function(c){plus.payment.request(d,c.RequestPara,function(){var c={tradeNo:b.par.tradeNo},d=setInterval(function(){1<b.m?(--b.m,a.post("api/Shop/GetTradeResult",c,function(c){c.IsSuccess&&(a.closeWaiting(),clearTimeout(d),c=a.User.get(),c.MB=parseFloat(c.MB)+parseFloat(b.amount),a.User.set(c),e.fire(plus.webview.getLaunchWebview(),"reload",{type:"userInfo"}),e.alert('\x3ci class\x3d"y y-finish y-green y-7x"\x3e\x3c/i\x3e\x3cp\x3e\u652f\u4ed8\u6210\u529f\x3c/p\x3e',"\x26nbsp;","\u5173\u95ed",function(){plus.webview.hide("wrecharge_add","none");plus.webview.close("wrecharge_add")},"div"))})):(clearTimeout(d),b.m=5,a.closeWaiting(),b.payStatusRetry())},2E3)},function(b){a.closeWaiting();a.log("\u652f\u4ed8\u5931\u8d25::"+JSON.stringify(b))})},function(){a.closeWaiting()}):plus.nativeUI.confirm("\u7cfb\u7edf\u6ca1\u6709\u5b89\u88c5\u201c"+d.description+"\u201d\u670d\u52a1\uff0c\u662f\u5426\u7acb\u5373\u5b89\u88c5",function(b){b.index||d.installService()},d.description)},payStatusRetry:function(){var b=this;e.confirm("\u652f\u4ed8\u672a\u5b8c\u6210\uff0c\u652f\u4ed8\u9047\u5230\u95ee\u9898","\x26nbsp;",["\u91cd\u65b0\u652f\u4ed8","\u652f\u4ed8\u5b8c\u6210"],function(d){1==d.index&&(a.showWaiting(),a.post("api/Shop/GetTradeResult",{tradeNo:b.par.tradeNo},function(c){a.closeWaiting();c.IsSuccess?(c=a.User.get(),c.MB=parseFloat(c.MB)+parseFloat(b.amount),a.User.set(c),e.fire(plus.webview.getLaunchWebview(),"reload",{type:"userInfo"}),e.alert('\x3ci class\x3d"y y-finish y-green y-7x"\x3e\x3c/i\x3e\x3cp\x3e\u652f\u4ed8\u6210\u529f\x3c/p\x3e',"\x26nbsp;","\u5173\u95ed",function(){plus.webview.hide("wrecharge_add","none");plus.webview.close("wrecharge_add")},"div")):b.payStatusRetry()},function(){a.closeWaiting()}))},"div")}},ready:function(){var b=this;e.init();e.plusReady(function(){plus.payment.getChannels(function(a){for(var c in a)b.payChannel[a[c].id]=a[c]},function(){a.log("\u83b7\u53d6\u652f\u4ed8\u901a\u9053\u5931\u8d25")})})}})});