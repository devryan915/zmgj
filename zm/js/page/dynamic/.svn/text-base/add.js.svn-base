define(["app","mui","vue","mui.previewimage","mui.zoom"],function(a,e,g,h,k){new g({el:"#app",data:{par:{content:"",address:"",guid:""},ref:{addr:""},imgList:[],imgTempList:[],imgUpList:[]},computed:{},methods:{addImg:function(b){var c=this,a=c.imgTempList.pop(),f="_doc/img/temp/"+(new Date).getTime()+".jpg";c.imgUpList.push(f);a={src:a,dst:f,width:"600px",height:"auto",format:"jpg",quality:70,overwrite:!0,rotate:0};if(plus.android)switch(f=a.src.replace("file://",""),f=plus.android.newObject("android.media.ExifInterface",f),plus.android.invoke(f,"getAttributeInt","Orientation",1)){case 3:a.rotate=180;break;case 8:a.rotate=270;break;case 6:a.rotate=90}plus.zip.compressImage(a,function(a){c.imgList.push({img:a.target,width:a.width,height:a.height});0<c.imgTempList.length?c.addImg(b):b&&b()})},add:function(){this.par.address=this.ref.addr;a.post("api/Posting/AddPost",this.par,function(b){a.closeWaiting();e.fire(plus.webview.getWebviewById("wdynamic_list"),"addData",{ref:{index:1,data:b}});e.toast("\u53d1\u5e03\u6210\u529f");e.os.plus&&plus.webview.currentWebview().close()},function(){a.closeWaiting()},!1,1E4)}},ready:function(){var b=this;e.init({swipeBack:!1});e.ready(function(){e.previewImage({deleteCall:function(a){b.imgList.splice(a,1);b.imgUpList.splice(a,1)}});document.getElementById("btnLocation").addEventListener("tap",function(){a.openWin("../pub/select_address.html","wpub_select_address",b.ref,function(a){},{popGesture:"close"})})});e.plusReady(function(){document.getElementById("btnSave").addEventListener("tap",function(){a.showWaiting();var c=a.createNonceStr();b.par.guid=c;if(b.imgList.length){for(var c=plus.uploader.createUpload(a.getUrl("api/Posting/AddPostPicNew"),{method:"POST",blocksize:0,priority:10,timeout:30,retry:1,retryInterval:5},function(c,d){200==d?(b.add(),console.log("\u4e0a\u4f20\u6210\u529f: "+c.url)):(console.log("\u4e0a\u4f20\u5931\u8d25: "+d),a.closeWaiting(),e.toast("\u53d1\u5e03\u5931\u8d25\uff0c\u8bf7\u91cd\u65b0\u53d1\u5e03"))}),d=0;d<b.imgUpList.length;d++)c.addFile(b.imgUpList[d],{key:d.toString()}),c.addData("guid",b.par.guid),c.addData("uid",a.User.getUserID());c.start()}else b.add()});document.getElementById("btnSelectImg").addEventListener("tap",function(){plus.nativeUI.actionSheet({title:"",cancel:"\u53d6\u6d88",buttons:[{title:"\u62cd\u7167"},{title:"\u4ece\u76f8\u518c\u9009\u62e9"}]},function(c){switch(c.index){case 1:c=plus.camera.getCamera();a.showWaiting();c.captureImage(function(c){b.imgTempList=[c];b.addImg(function(){a.closeWaiting()})},function(b){a.closeWaiting()},{filename:"_doc/img/temp/temp.jpg",format:c.supportedImageFormats[0],resolution:c.supportedImageResolutions[0]});break;case 2:var d=9-b.imgList.length;plus.gallery.pick(function(c){a.showWaiting();b.imgTempList=c.files.reverse().slice();b.addImg(function(){a.closeWaiting()})},function(){},{filename:"_doc/img/temp/",filter:"filter",maximum:d,multiple:!0,system:!1,onmaxed:function(){plus.nativeUI.toast("\u60a8\u6700\u591a\u53ea\u80fd\u9009\u62e9"+d+"\u5f20\u56fe\u7247")}})}})});window.addEventListener("unload",function(c){b.imgList=[];b.imgUpList=[];b.ref.addr="\u6240\u5728\u4f4d\u7f6e";a.closeWaiting()});window.addEventListener("reAddr",function(a){b.ref=a.detail.ref})})}})});