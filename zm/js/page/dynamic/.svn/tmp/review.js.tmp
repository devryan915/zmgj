<<<<<<< .mine
define(["app","mui","vue","mui.previewimage","mui.zoom"],function(d,c,h,k,l){new h({el:"#app",data:{par:{postId:"",pageIndex:0,pageSize:15},isUp:!0,pageCount:0,list:[],o:null,parReview:{postId:"",content:"",discussType:1},ui:{h:document.getElementById("h"),txtAsk:document.getElementById("txtAsk"),footer:document.getElementById("footer"),content:document.querySelector(".mui-content"),btnSave:document.getElementById("btnSave"),txtFocus:function(){var a=this;a.txtAsk.focus();setTimeout(function(){a.txtAsk.focus()},150);a.h.style.width=a.txtAsk.offsetWidth+"px"}},selectIndex:0,user:d.User.get()},computed:{isValid:function(){return!!this.parReview.content}},methods:{load:function(){var a=this;d.post("api/Posting/GetPDiscuss",a.par,function(b){a.pageCount=b.Pages;1==a.par.pageIndex&&(a.o=b.Other);a.isUp?a.list=a.list.concat(b.Items):(a.list=b.Items,c("#pr").pullRefresh().refresh(!0));d.loadImg();d.ellipsisToggle();d.closeWaiting();c("#pr").pullRefresh().endPullupToRefresh(a.par.pageIndex>=a.pageCount)},function(){a.par.pageIndex--;d.closeWaiting();c("#pr").pullRefresh().endPullupToRefresh(!1)})},review:function(){var a=this,b=d.User.get();b.ImgUrl&&(b.NickName||b.RealName)?(d.showWaiting(),d.post("api/Posting/PDiscuss",a.parReview,function(e){1==a.parReview.discussType?(a.list.unshift({PDiscuss:{Name:b.NickName,ImgUrl:b.ImgUrl,IssDT:(new Date).toString().Format("yyyy-MM-dd hh:mm.ss"),Content:a.parReview.content,DisId:e,DNums:0,PNums:0},Replys:[]}),c(".mui-scroll-wrapper").scroll().scrollTo(0,0,100)):(a.list[a.selectIndex].PDiscuss.DNums++,a.list[a.selectIndex].Replys.unshift({Name:b.NickName,ImgUrl:b.ImgUrl,IssDT:(new Date).toString().Format("yyyy-MM-dd hh:mm.ss"),Content:a.parReview.content,rplId:e,DisId:a.par.postId,DNums:0,PNums:0}));c.fire(plus.webview.getWebviewById("wdynamic_list"),"refreshNum",{ref:{type:1}});a.o.DNums++;a.parReview.content="";a.ui.txtAsk.value="";c.trigger(a.ui.txtAsk,"input",null);a.parReview.discussType=1;a.parReview.postId=a.par.postId;a.ui.txtAsk.blur();d.loadImg();d.closeWaiting()},function(){d.closeWaiting()})):c.toast(b.ImgUrl?"\u8bf7\u5148\u586b\u5199\u771f\u540d\u6216\u6635\u79f0":"\u8bf7\u5148\u4e0a\u4f20\u5934\u50cf")},initEvent:function(){var a=this;a.ui.footer.addEventListener("tap",function(a){a.preventDefault()});a.ui.txtAsk.addEventListener("tap",function(b){a.ui.txtFocus()},!1);a.ui.txtAsk.addEventListener("input",function(){a.ui.h.innerText=this.value.replace(RegExp("\n","gm"),"\n-")||"-";a.ui.footer.style.height=a.ui.h.offsetHeight+a.ui.footer.offsetHeight-this.offsetHeight+"px"});c("#app").on("tap",".y-attention",function(){var a=this,c="true"==a.dataset.isattention;d.post(c?"api/Posting/DeleteFocusUser":"api/Posting/AddFocusUser",{userID:a.dataset.userid},function(b){a.innerText=c?"+ \u5173\u6ce8":"\u53d6\u6d88\u5173\u6ce8";a.dataset.isattention=(!c).toString()})});c(".y-card-list").on("tap","a[data-type]",function(){var b=this,e=b.parentNode,f={postId:e.dataset.id,clickType:b.dataset.type},g=e.dataset.listIndex;switch(parseInt(b.dataset.type)){case 1:d.post("api/Posting/ClickLike",f,function(d){d=b.querySelector("i");d.classList.remove("y-collect-o");d.classList.add("y-collect");d.classList.add("y-yellow");a.o.CNums++;b.dataset.type=5;c.toast("\u6536\u85cf\u6210\u529f")});break;case 2:d.post("api/Posting/ClickLike",f,function(c){c=b.querySelector("i");c.classList.remove("y-heart-o");c.classList.add("y-heart");c.classList.add("y-red");a.o.PNums++;b.dataset.type=9});break;case 3:d.post("api/Posting/ClickLike",f,function(c){g=e.dataset.index;b.classList.remove("y-heart-o");b.classList.add("y-heart");b.classList.add("y-red");a.list[g].PDiscuss.PNums++;b.dataset.type=1E3});break;case 4:d.post("api/Posting/ClickLike",f,function(c){c=e.dataset.index;b.classList.remove("y-heart-o");b.classList.add("y-heart");b.classList.add("y-red");a.list[g].Replys[c].PNums++;b.dataset.type=1E3});break;case 5:d.post("api/Posting/ClickLike",f,function(d){d=b.querySelector("i");d.classList.add("y-collect-o");d.classList.remove("y-collect");d.classList.remove("y-yellow");a.o.CNums--;b.dataset.type=1;c.toast("\u53d6\u6d88\u6536\u85cf")});break;case 102:a.selectIndex=e.dataset.index,a.ui.txtAsk.placeholder="\u56de\u590d:"+a.list[a.selectIndex].PDiscuss.Name,a.ui.txtFocus(),a.parReview.discussType=2,a.parReview.postId=e.dataset.id}return!1});document.getElementById("pr").addEventListener("tap",function(){a.ui.txtAsk.placeholder="\u53d1\u8868\u8bc4\u8bba";a.parReview.discussType=1;a.parReview.postId=a.par.postId;a.ui.txtAsk.blur()});a.ui.btnSave.addEventListener("tap",function(b){b.preventDefault();a.review();return!1})}},ready:function(){var a=this;c.init({pullRefresh:{container:"#pr",up:{contentrefresh:"\u6b63\u5728\u52a0\u8f7d...",contentnomore:"\u5df2\u52a0\u8f7d\u5168\u90e8",callback:function(){a.par.pageIndex++;a.load()}}},gestureConfig:{tap:!0,doubletap:!0,longtap:!0,swipe:!0,drag:!0,hold:!0,release:!0}});c.ready(function(){a.initEvent();c.os.plus||(a.par.postId=d.getQueryString("ref.id"),a.parReview.postId=a.par.postId,c("#pr").pullRefresh().pullupLoading());c.previewImage();a.ui.h.style.width=a.ui.txtAsk.offsetWidth+"px"});c.plusReady(function(){plus.webview.currentWebview().setStyle({softinputMode:"adjustResize"});window.addEventListener("reload",function(b){a.user=d.User.get();a.par.postId=b.detail.ref.id;a.par.pageIndex=0;a.parReview.postId=a.par.postId;setTimeout(function(){c(".mui-scroll-wrapper").scroll().scrollTo(0,0,100)},500);setTimeout(function(){c("#pr").pullRefresh().pullupLoading()},1E3)});window.addEventListener("unload",function(b){a.list=[];a.o=null;c("#pr").pullRefresh().refresh(!0);a.parReview.content="";setTimeout(function(){c(".mui-scroll-wrapper").scroll().scrollTo(0,0,100)},500);a.ui.txtAsk.value="";c.trigger(a.ui.txtAsk,"input",null)});var b=plus.webview.currentWebview();b.ref&&(a.par.postId=b.ref.id,a.parReview.postId=a.par.postId,a.list=[],setTimeout(function(){c("#pr").pullRefresh().refresh(!0);c("#pr").pullRefresh().pullupLoading()},1E3))})}})});=======
define(["app","mui","vue","mui.previewimage","mui.zoom"],function(d,c,h,k,l){new h({el:"#app",data:{par:{postId:"",pageIndex:0,pageSize:15},isUp:!0,pageCount:0,list:[],o:null,parReview:{postId:"",content:"",discussType:1},ui:{h:document.getElementById("h"),txtAsk:document.getElementById("txtAsk"),footer:document.getElementById("footer"),content:document.querySelector(".mui-content"),btnSave:document.getElementById("btnSave"),txtFocus:function(){var a=this;a.txtAsk.focus();setTimeout(function(){a.txtAsk.focus()},150);a.h.style.width=a.txtAsk.offsetWidth+"px"}},selectIndex:0,user:d.User.get()},computed:{isValid:function(){return!!this.parReview.content}},methods:{load:function(){var a=this;d.post("api/Posting/GetPDiscuss",a.par,function(b){a.pageCount=b.Pages;1==a.par.pageIndex&&(a.o=b.Other);a.isUp?a.list=a.list.concat(b.Items):(a.list=b.Items,c("#pr").pullRefresh().refresh(!0));d.loadImg();d.ellipsisToggle();d.closeWaiting();c("#pr").pullRefresh().endPullupToRefresh(a.par.pageIndex>=a.pageCount)},function(){a.par.pageIndex--;d.closeWaiting();c("#pr").pullRefresh().endPullupToRefresh(!1)})},review:function(){var a=this,b=d.User.get();b.ImgUrl&&(b.NickName||b.RealName)?(d.showWaiting(),d.post("api/Posting/PDiscuss",a.parReview,function(e){1==a.parReview.discussType?(a.list.unshift({PDiscuss:{Name:b.NickName,ImgUrl:b.ImgUrl,IssDT:(new Date).toString().Format("yyyy-MM-dd hh:mm.ss"),Content:a.parReview.content,DisId:e,DNums:0,PNums:0},Replys:[]}),c(".mui-scroll-wrapper").scroll().scrollTo(0,0,100)):(a.list[a.selectIndex].PDiscuss.DNums++,a.list[a.selectIndex].Replys.unshift({Name:b.NickName,ImgUrl:b.ImgUrl,IssDT:(new Date).toString().Format("yyyy-MM-dd hh:mm.ss"),Content:a.parReview.content,rplId:e,DisId:a.par.postId,DNums:0,PNums:0}));c.fire(plus.webview.getWebviewById("wdynamic_list"),"refreshNum",{ref:{type:1}});a.o.DNums++;a.parReview.content="";a.ui.txtAsk.value="";c.trigger(a.ui.txtAsk,"input",null);a.parReview.discussType=1;a.parReview.postId=a.par.postId;a.ui.txtAsk.blur();d.loadImg();d.closeWaiting()},function(){d.closeWaiting()})):c.toast(b.ImgUrl?"\u8bf7\u5148\u586b\u5199\u771f\u540d\u6216\u6635\u79f0":"\u8bf7\u5148\u4e0a\u4f20\u5934\u50cf")},initEvent:function(){var a=this;a.ui.footer.addEventListener("tap",function(a){a.preventDefault()});a.ui.txtAsk.addEventListener("tap",function(b){a.ui.txtFocus()},!1);a.ui.txtAsk.addEventListener("input",function(){a.ui.h.innerText=this.value.replace(RegExp("\n","gm"),"\n-")||"-";a.ui.footer.style.height=a.ui.h.offsetHeight+a.ui.footer.offsetHeight-this.offsetHeight+"px"});c("#app").on("tap",".y-attention",function(){var a=this,c="true"==a.dataset.isattention;d.post(c?"api/Posting/DeleteFocusUser":"api/Posting/AddFocusUser",{userID:a.dataset.userid},function(b){a.innerText=c?"+ \u5173\u6ce8":"\u53d6\u6d88\u5173\u6ce8";a.dataset.isattention=(!c).toString()})});c(".y-card-list").on("tap","a[data-type]",function(){var b=this,e=b.parentNode,f={postId:e.dataset.id,clickType:b.dataset.type},g=e.dataset.listIndex;switch(parseInt(b.dataset.type)){case 1:d.post("api/Posting/ClickLike",f,function(d){d=b.querySelector("i");d.classList.remove("y-collect-o");d.classList.add("y-collect");d.classList.add("y-yellow");a.o.CNums++;b.dataset.type=5;c.toast("\u6536\u85cf\u6210\u529f")});break;case 2:d.post("api/Posting/ClickLike",f,function(c){c=b.querySelector("i");c.classList.remove("y-heart-o");c.classList.add("y-heart");c.classList.add("y-red");a.o.PNums++;b.dataset.type=9});break;case 3:d.post("api/Posting/ClickLike",f,function(c){g=e.dataset.index;b.classList.remove("y-heart-o");b.classList.add("y-heart");b.classList.add("y-red");a.list[g].PDiscuss.PNums++;b.dataset.type=1E3});break;case 4:d.post("api/Posting/ClickLike",f,function(c){c=e.dataset.index;b.classList.remove("y-heart-o");b.classList.add("y-heart");b.classList.add("y-red");a.list[g].Replys[c].PNums++;b.dataset.type=1E3});break;case 5:d.post("api/Posting/ClickLike",f,function(d){d=b.querySelector("i");d.classList.add("y-collect-o");d.classList.remove("y-collect");d.classList.remove("y-yellow");a.o.CNums--;b.dataset.type=1;c.toast("\u53d6\u6d88\u6536\u85cf")});break;case 102:a.selectIndex=e.dataset.index,a.ui.txtAsk.placeholder="\u56de\u590d:"+a.list[a.selectIndex].PDiscuss.Name,a.ui.txtFocus(),a.parReview.discussType=2,a.parReview.postId=e.dataset.id}return!1});document.getElementById("pr").addEventListener("tap",function(){a.ui.txtAsk.placeholder="\u53d1\u8868\u8bc4\u8bba";a.parReview.discussType=1;a.parReview.postId=a.par.postId;a.ui.txtAsk.blur()});a.ui.btnSave.addEventListener("tap",function(b){b.preventDefault();a.review();return!1})}},ready:function(){var a=this;c.init({pullRefresh:{container:"#pr",up:{contentrefresh:"\u6b63\u5728\u52a0\u8f7d...",contentnomore:"\u5df2\u52a0\u8f7d\u5168\u90e8",callback:function(){a.par.pageIndex++;a.load()}}},gestureConfig:{tap:!0,doubletap:!0,longtap:!0,swipe:!0,drag:!0,hold:!0,release:!0}});c.ready(function(){a.initEvent();c.os.plus||(a.par.postId=d.getQueryString("ref.id"),a.parReview.postId=a.par.postId,c("#pr").pullRefresh().pullupLoading());c.previewImage();a.ui.h.style.width=a.ui.txtAsk.offsetWidth+"px"});c.plusReady(function(){plus.webview.currentWebview().setStyle({softinputMode:"adjustResize"});window.addEventListener("reload",function(b){a.user=d.User.get();a.par.postId=b.detail.ref.id;a.par.pageIndex=0;a.parReview.postId=a.par.postId;setTimeout(function(){c("#pr").pullRefresh().pullupLoading()},1E3)});window.addEventListener("unload",function(b){a.list=[];a.o=null;c("#pr").pullRefresh().refresh(!0);a.parReview.content="";setTimeout(function(){c(".mui-scroll-wrapper").scroll().scrollTo(0,0,100)},500);a.ui.txtAsk.value="";c.trigger(a.ui.txtAsk,"input",null)});var b=plus.webview.currentWebview();b.ref&&(a.par.postId=b.ref.id,a.parReview.postId=a.par.postId,a.list=[],setTimeout(function(){c("#pr").pullRefresh().refresh(!0);c("#pr").pullRefresh().pullupLoading()},1E3))})}})});>>>>>>> .r2258
