define(["app","mui","vue"],function(a,e,q){var k=document.getElementById("header"),l=document.getElementById("pr"),h="windex";new q({el:"#pr",data:{ui:{content:document.getElementById("pr"),show:function(){this.content.classList.remove("mui-hidden")},hide:function(){this.content.classList.add("mui-hidden")}},par:{lastDT:a.User.get().LastDT},menus:{windex:{href:"",header:"",isloaded:"1"},wme_me:{href:"../me/me.html",header:"",isloaded:"0"},wfriend_list:{href:"../friend/list.html",header:'\x3ch1 class\x3d"mui-title"\x3e\u597d\u53cb\x3c/h1\x3e',isloaded:"1"},wdynamic_list:{href:"../dynamic/list.html",header:"",isloaded:"0"},wclub_list:{href:"../equestrian/about.html",header:"",isloaded:"1"}},o:null,user:a.User.get()},methods:{load:function(){var d=this;a.post("api/News/GetFirstPage",d.par,function(b){JSON.stringify(d.o)!=JSON.stringify(b)&&(d.o=b,a.Cache.setObject(a.Cache.key.cindexData.toKeyName(),d.o),a.loadImg());b.UserInfo&&a.User.set(b.UserInfo);e("#slider").slider({interval:5E3});d.ui.show();a.closeWaiting()},function(){a.closeWaiting();d.o||a.showError(function(){d.ui.hide();a.showWaiting(1);d.load()},1)});a.loadImg()},initIndex:function(){plus.screen.lockOrientation("portrait");plus.navigator.closeSplashscreen();plus.navigator.setStatusBarStyle("UIStatusBarStyleBlackOpaque");plus.navigator.setStatusBarBackground("#282828")},loadMenu:function(){var d=this,b=plus.webview.currentWebview(),c;for(c in d.menus){var f={top:"0px",bottom:"50px",render:"always",scrollIndicator:"none"},g=d.menus[c];g.header.length&&(f.top="44px");"windex"!=c&&(f=plus.webview.create(g.href,c,f),f.hide(),b.append(f))}d.user.UserID||e.preload({url:"../login/login.html",id:"wlogin",styles:{popGesture:"hide"}});var n={};e("#nav").on("touchend","a",function(c){c.preventDefault();var b=this.dataset.id;if("0"==d.menus[b].isloaded)c.stopPropagation();else if("wfriend_list"==b)e.toast("\u677f\u5757\u5efa\u8bbe\u4e2d\uff0c\u656c\u8bf7\u671f\u5f85"),c.stopPropagation();else{if(b&&b!=h&&"wfriend_list"!=b)if("wme_me"!=b||d.user.UserID){c=plus.webview.getWebviewById(b);e.fire(c,"onTabTap",{});var f=200,p="fade-in";if(e.os.ios||n[b])f=0,p="none";"windex"==b?(k.classList.add("mui-hidden"),l.classList.remove("mui-hidden"),plus.webview.hide(h)):(n[b]=!0,l.classList.add("mui-hidden"),c.show(p,f,function(){}),h&&plus.webview.hide(h));h=b;c=document.querySelector("#nav a.mui-active");b=document.querySelector("#nav a[data-id\x3d'"+b+"']");b!==c&&(c.classList.remove("mui-active"),b.classList.add("mui-active"))}else a.showLogin(),k.dataset.id=b,a.Cache.set("gotab",!0);return!1}});window.addEventListener("gotab",function(b){d.user="userInfo"==b.detail.type&&a.User.get();e.fire(plus.webview.getWebviewById("wme_me"),"reload",{type:"userInfo"});b=void 0!=b.detail.id?b.detail.id:k.dataset.id;k.dataset.id=b;var c=plus.webview.getWebviewById(b);"windex"==b?(k.classList.add("mui-hidden"),l.classList.remove("mui-hidden")):(l.classList.add("mui-hidden"),e.fire(c,"onTabTap",{}),c.show("fade-in",200,function(){}));plus.webview.hide(h);h=b;c=document.querySelector("#nav a.mui-active");b=document.querySelector("#nav a[data-id\x3d'"+b+"']");b!==c&&(c&&c.classList.remove("mui-active"),b.classList.add("mui-active"))});setTimeout(function(){d.initIndex()},200);var m=0;e.back=function(a){m++;1<m?plus.runtime.quit():plus.nativeUI.toast("\u518d\u6309\u4e00\u6b21\u9000\u51fa\u5e94\u7528");setTimeout(function(){m=0},1E3);return!1}},getVersionNum:function(a){if(null==a||""==a)return 0;a=a.split(".");return 1E5*a[0]+1E3*a[1]+1*a[2]},pushMsg:function(a){if(a.payload){var b=a.payload;"string"==typeof a.payload&&(b=JSON.parse(a.payload));a=b.data;switch(a.type){case "openWindow":var c=plus.webview.getWebviewById(a.id);c?(e.fire(c,"reload",{ref:a.ref}),c.show("slide-in-right")):(c=e.preload({id:a.id,url:a.href,styles:{popGesture:"hide"},extras:{ref:a.ref}}),c.show("slide-in-right"),c.addEventListener("hide",function(){e.fire(c,"unload",{})}));break;case "reloadWindow":(c=plus.webview.getWebviewById(a.id))&&e.fire(c,"reload",{ref:a.ref})}}},getVer:function(){var d=this;a.post("api/Common/GetSUI",{verType:a.appType},function(b){var c=d.getVersionNum(a.version),f=d.getVersionNum(b.MinVer),g=d.getVersionNum(b.MaxVer);0!=g&&(b.Remark.replace(RegExp("\x3cbr/\x3e","g"),"\r\n"),g>c&&(c>=f?a.down(b.AddPath,a.upFile,function(c){a.Cache.set(a.Cache.key.isUpFile.toKeyName(),!0);3==a.appType||e.toast(b.MaxVer+" \u66f4\u65b0\u4e0b\u8f7d\u6210\u529f\uff0c\u91cd\u542fapp\u540e\u5b89\u88c5\u66f4\u65b0")}):"Android"==plus.os.name?plus.networkinfo.getCurrentType()==plus.networkinfo.CONNECTION_WIFI?e.alert("\u5f53\u524d\u7248\u672c\u4f4e\u4e8e\u6700\u5c0f\u8fd0\u884c\u7248\u672c\uff0c\u5fc5\u987b\u66f4\u65b0\u540e\u4f7f\u7528\r\n","\u66f4\u65b0\u63d0\u793a",function(){a.down(b.ApkPath,a.appFile,function(a){plus.runtime.openFile(a.filename)},!0)}):e.confirm("\u5f53\u524d\u7248\u672c\u4f4e\u4e8e\u6700\u5c0f\u8fd0\u884c\u7248\u672c\uff0c\u5fc5\u987b\u66f4\u65b0\u540e\u4f7f\u7528\r\n",c+" \u65b0\u7248\u53d1\u5e03",["\u66f4\u65b0","\u53d6\u6d88"],function(c){0==c.index?a.down(b.ApkPath,a.appFile,function(a){plus.runtime.openFile(a.filename)}):plus.runtime.quit()}):"iOS"==plus.os.name&&(b.AppPath?e.alert("\u5f53\u524d\u7248\u672c\u4f4e\u4e8e\u6700\u5c0f\u8fd0\u884c\u7248\u672c\uff0c\u5fc5\u987b\u66f4\u65b0\u540e\u4f7f\u7528\r\n","\u66f4\u65b0\u63d0\u793a",function(){plus.runtime.openURL(b.AppPath)}):e.alert("\u5f53\u524d\u7248\u672c\u4f4e\u4e8e\u6700\u5c0f\u8fd0\u884c\u7248\u672c\uff0c\u5fc5\u987b\u66f4\u65b0\u540e\u4f7f\u7528\r\n","\u66f4\u65b0\u63d0\u793a",function(){a.down(b.AddPath,a.upFile,function(c){plus.runtime.install(a.upFile,{force:!0},function(){a.version=b.MaxVer;a.Cache.set(a.Cache.key.upFileVer.toKeyName(),b.MaxVer);a.Cache.set(a.Cache.key.isUpFile.toKeyName(),!1);a.Cache.set(a.Cache.key.isRestartOpen.toKeyName(),!0);e.fire(plus.webview.getWebviewById("wme_info_setting"),"reload",{});a.log("\u5b89\u88c5\u66f4\u65b0\u6210\u529f");plus.runtime.restart()},function(b){a.log("\u5b89\u88c5\u66f4\u65b0\u5931\u8d25")})},!0)}))))})}},created:function(){(this.o=a.Cache.getObject(a.Cache.key.cindexData.toKeyName()))||a.showWaiting(1);a.loadImg();this.ui.show();this.o&&a.showWaiting()},ready:function(){var d=this;e.init();e.ready(function(){window.addEventListener("tabItemLoaded",function(a){a.detail.id&&(d.menus[a.detail.id].isloaded="1")});d.load();e(".mui-scroll-wrapper").scroll({indicators:!1});window.addEventListener("reload",function(b){"userInfo"==b.detail.type&&(d.user=a.User.get(),e.fire(plus.webview.getWebviewById("wme_me"),"reload",{type:"userInfo"}))});e("#app").on("tap",'[data-id^\x3d"w"]',function(){if("wstore_list"==this.dataset.id||"wclass_list"==this.dataset.id||"wrider_list"==this.dataset.id)e.toast("\u677f\u5757\u5efa\u8bbe\u4e2d\uff0c\u656c\u8bf7\u671f\u5f85");else{var a=this.dataset.data?JSON.parse(this.dataset.data):{};if(e.os.plus){var c=plus.webview.getWebviewById(this.dataset.id);c?(e.fire(c,"reload",{ref:a}),c.show("pop-in")):(c=e.preload({id:this.dataset.id,url:this.dataset.href,styles:{popGesture:"hide",scrollIndicator:"none"},extras:{ref:a}}),c.show("pop-in"),c.addEventListener("hide",function(){e.fire(c,"unload",{})}))}else{var d="?",g;for(g in a)d+="ref."+g+"\x3d"+a[g]+"\x26";location.href=this.dataset.href+d}}});setTimeout(function(){a.Cache.iclearExpired()},3E4)});e.plusReady(function(){a.log("\u68c0\u67e5\u662f\u5426\u6709\u66f4\u65b0\uff1a"+a.version+"|"+a.Cache.getBoolean(a.Cache.key.isUpFile.toKeyName())+"|"+a.Cache.getBoolean(a.Cache.key.isRestartOpen.toKeyName()));if(a.Cache.getBoolean(a.Cache.key.isUpFile.toKeyName()))plus.runtime.install(a.upFile,{force:!1},function(){a.version=a.Cache.getString(a.Cache.key.upFileVer.toKeyName());a.Cache.set(a.Cache.key.isUpFile.toKeyName(),!1);a.Cache.set(a.Cache.key.isRestartOpen.toKeyName(),!0);a.log("\u5b89\u88c5\u66f4\u65b0\u6210\u529f");plus.runtime.restart()},function(c){a.log("\u5b89\u88c5\u66f4\u65b0\u5931\u8d25")});else{d.loadMenu();var b=!0;plus.push.addEventListener("click",function(a){plus.runtime.setBadgeNumber(0);d.pushMsg(a)},!1);plus.push.addEventListener("receive",function(a){if(a.aps)plus.runtime.setBadgeNumber(b?0:1),a.payload.LocalMSG=!0,plus.push.createMessage(a.content,JSON.stringify(a.payload),{title:a.title,cover:!1});else{var c=a.payload;"string"==typeof a.payload&&(c=JSON.parse(a.payload));c.LocalMSG||d.pushMsg(a)}},!1);document.addEventListener("pause",function(){b=!1},!1);document.addEventListener("resume",function(){b=!0},!1);a.Cache.getBoolean(a.Cache.key.isRestartOpen.toKeyName())?a.Cache.set(a.Cache.key.isRestartOpen.toKeyName(),!1):setTimeout(function(){d.getVer()},2E3)}})}})});