define(["app","mui","vue"],function(a,e,t){var k=document.getElementById("header"),l=document.getElementById("pr"),f="windex",n=document.querySelector(".wexin-login"),p=document.querySelector(".broad"),h=document.getElementById("weixinBtn");new t({el:"#pr",data:{ui:{content:document.getElementById("pr"),show:function(){this.content.classList.remove("mui-hidden")},hide:function(){this.content.classList.add("mui-hidden")}},par:{lastDT:a.User.get().LastDT},menus:{windex:{href:"",header:"",isloaded:"1"},wme_me:{href:"../me/me.html",header:"",isloaded:"0"},wfriend_list:{href:"../friend/list.html",header:'\x3ch1 class\x3d"mui-title"\x3e\u597d\u53cb\x3c/h1\x3e',isloaded:"1"},wdynamic_list:{href:"../dynamic/list.html",header:"",isloaded:"0"},wclub_list:{href:"../equestrian/about.html",header:"",isloaded:"1"}},o:null,user:a.User.get()},methods:{loginWexinCall:function(a){switch(a){case 1:n.classList.add("mui-hidden");this.refreshUser();break;case 2:n.classList.add("mui-hidden");break;case 3:e(h).button("reset")}},refreshUser:function(){this.user=a.User.get();e.fire(plus.webview.getLaunchWebview(),"reload",{type:"userInfo"});e.fire(plus.webview.getWebviewById("wdynamic_list"),"reload",{})},loginWexin:function(){e(h).button("reset");e(h).button("loading");a.reloginWexin(this.loginWexinCall)},load:function(){var d=this;a.post("api/News/GetFirstPage",d.par,function(b){b&&(d.o=b,a.Cache.setObject(a.Cache.key.cindexData.toKeyName(),d.o),a.loadImg());e("#slider").slider({interval:5E3});d.ui.show();a.closeWaiting()},function(){a.closeWaiting();d.o||a.showError(function(){d.ui.hide();a.showWaiting(1);d.load()},1)});a.loadImg()},initIndex:function(){plus.screen.lockOrientation("portrait");plus.navigator.closeSplashscreen();plus.navigator.setStatusBarStyle("UIStatusBarStyleBlackOpaque");plus.navigator.setStatusBarBackground("#282828")},loadMenu:function(){var d=this,b=plus.webview.currentWebview(),c;for(c in d.menus){var g={top:"0px",bottom:"50px",render:"always",scrollIndicator:"none"},q=d.menus[c];q.header.length&&(g.top="44px");"windex"!=c&&(g=plus.webview.create(q.href,c,g),g.hide(),b.append(g))}var h={};e("#nav").on("touchend","a",function(c){c.preventDefault();var b=this.dataset.id;if("0"==d.menus[b].isloaded)c.stopPropagation();else if("wfriend_list"==b)"windex"==f?a.fExpect():(b=plus.webview.getWebviewById(f),e.fire(b,"fExpect",{})),c.stopPropagation();else{if(b&&b!=f&&"wfriend_list"!=b){c=plus.webview.getWebviewById(b);e.fire(c,"onTabTap",{});var g=200,r="fade-in";if(e.os.ios||h[b])g=0,r="none";"windex"==b?(k.classList.add("mui-hidden"),l.classList.remove("mui-hidden"),plus.webview.hide(f)):(h[b]=!0,l.classList.add("mui-hidden"),c.show(r,g,function(){}),f&&plus.webview.hide(f));f=b;c=document.querySelector("#nav a.mui-active");b=document.querySelector("#nav a[data-id\x3d'"+b+"']");b!==c&&(c.classList.remove("mui-active"),b.classList.add("mui-active"))}return!1}});window.addEventListener("gotab",function(b){d.user="userInfo"==b.detail.type&&a.User.get();e.fire(plus.webview.getWebviewById("wme_me"),"reload",{type:"userInfo"});b=void 0!=b.detail.id?b.detail.id:k.dataset.id;k.dataset.id=b;var c=plus.webview.getWebviewById(b);"windex"==b?(k.classList.add("mui-hidden"),l.classList.remove("mui-hidden")):(l.classList.add("mui-hidden"),e.fire(c,"onTabTap",{}),c.show("fade-in",200,function(){}));plus.webview.hide(f);f=b;c=document.querySelector("#nav a.mui-active");b=document.querySelector("#nav a[data-id\x3d'"+b+"']");b!==c&&(c&&c.classList.remove("mui-active"),b.classList.add("mui-active"))});setTimeout(function(){d.initIndex()},200);var m=0;e.back=function(b){m++;1<m?plus.runtime.quit():plus.nativeUI.toast("\u518d\u6309\u4e00\u6b21\u9000\u51fa\u5e94\u7528");setTimeout(function(){m=0},1E3);return!1}},getVersionNum:function(a){if(null==a||""==a)return 0;a=a.split(".");return 1E5*a[0]+1E3*a[1]+1*a[2]},pushMsg:function(a){if(a.payload){var b=a.payload;"string"==typeof a.payload&&(b=JSON.parse(a.payload));a=b.data;switch(a.type){case "openWindow":var c=plus.webview.getWebviewById(a.id);c?(e.fire(c,"reload",{ref:a.ref}),c.show("slide-in-right")):(c=e.preload({id:a.id,url:a.href,styles:{popGesture:"hide"},extras:{ref:a.ref}}),c.show("slide-in-right"),c.addEventListener("hide",function(){e.fire(c,"unload",{})}));break;case "reloadWindow":(c=plus.webview.getWebviewById(a.id))&&e.fire(c,"reload",{ref:a.ref})}}},getVer:function(){var d=this;a.post("api/Common/GetSUI",{verType:a.appType},function(b){var c=d.getVersionNum(a.version),g=d.getVersionNum(b.MinVer),f=d.getVersionNum(b.MaxVer);0!=f&&f>c&&(c>=g?a.down(b.AddPath,a.upFile,function(c){a.Cache.set(a.Cache.key.isUpFile.toKeyName(),!0);3==a.appType||e.toast(b.MaxVer+" \u66f4\u65b0\u4e0b\u8f7d\u6210\u529f\uff0c\u91cd\u542fapp\u540e\u5b89\u88c5\u66f4\u65b0")}):e.openWindow({url:"../pub/appupgrade.html",id:"pub_appupgrade",extras:{edata:b}}))})}},created:function(){(this.o=a.Cache.getObject(a.Cache.key.cindexData.toKeyName()))||a.loadImg();this.ui.show()},ready:function(){var d=this;e.init();e.ready(function(){d.load();a.Cache.getBoolean("isShowBroad999")&&p.classList.add("mui-hidden");window.addEventListener("tabItemLoaded",function(a){a.detail.id&&(d.menus[a.detail.id].isloaded="1")});e(".mui-scroll-wrapper").scroll({indicators:!1});window.addEventListener("reload",function(b){"userInfo"==b.detail.type&&(d.user=a.User.get(),e.fire(plus.webview.getWebviewById("wme_me"),"reload",{type:"userInfo"}))});e(".broad-bottom").on("tap","button",function(){p.classList.add("mui-hidden");"1"!=this.dataset.id&&"2"==this.dataset.id&&a.Cache.set("isShowBroad999",!0)});e(".wexin-content").on("tap","button",function(){d.loginWexin()});e("#app").on("tap",'[data-id^\x3d"w"]',function(){var b=this.dataset.id;if("wstore_list"==b||"wclass_list"==b||"wrider_list"==b)a.fExpect();else{var c=this.dataset.data?JSON.parse(this.dataset.data):{};if("wrider_list"==b)a.openPage(this.dataset.href,b,c,function(a){});else if(e.os.plus){var d=plus.webview.getWebviewById(b);d?(e.fire(d,"reload",{ref:c}),d.show("pop-in")):(d=e.preload({id:b,url:this.dataset.href,styles:{popGesture:"hide",scrollIndicator:"none"},extras:{ref:c}}),d.show("pop-in"),d.addEventListener("hide",function(){e.fire(d,"unload",{})}))}else{var b="?",f;for(f in c)b+="ref."+f+"\x3d"+c[f]+"\x26";location.href=this.dataset.href+b}}});setTimeout(function(){a.Cache.iclearExpired()},3E4)});e.plusReady(function(){e(h).button("loading");a.AutologinWexin(d.loginWexinCall);a.log("\u68c0\u67e5\u662f\u5426\u6709\u66f4\u65b0\uff1a"+a.version+"|"+a.Cache.getBoolean(a.Cache.key.isUpFile.toKeyName())+"|"+a.Cache.getBoolean(a.Cache.key.isRestartOpen.toKeyName()));if(a.Cache.getBoolean(a.Cache.key.isUpFile.toKeyName()))plus.runtime.install(a.upFile,{force:!1},function(){a.version=a.Cache.getString(a.Cache.key.upFileVer.toKeyName());a.Cache.set(a.Cache.key.isUpFile.toKeyName(),!1);a.Cache.set(a.Cache.key.isRestartOpen.toKeyName(),!0);a.log("\u5b89\u88c5\u66f4\u65b0\u6210\u529f");plus.runtime.restart()},function(b){a.log("\u5b89\u88c5\u66f4\u65b0\u5931\u8d25")});else{d.loadMenu();var b=!0;plus.push.addEventListener("click",function(a){plus.runtime.setBadgeNumber(0);d.pushMsg(a)},!1);plus.push.addEventListener("receive",function(a){if(a.aps)plus.runtime.setBadgeNumber(b?0:1),a.payload.LocalMSG=!0,plus.push.createMessage(a.content,JSON.stringify(a.payload),{title:a.title,cover:!1});else{var c=a.payload;"string"==typeof a.payload&&(c=JSON.parse(a.payload));c.LocalMSG||d.pushMsg(a)}},!1);document.addEventListener("pause",function(){b=!1},!1);document.addEventListener("resume",function(){b=!0},!1);a.Cache.getBoolean(a.Cache.key.isRestartOpen.toKeyName())?a.Cache.set(a.Cache.key.isRestartOpen.toKeyName(),!1):setTimeout(function(){d.getVer()},2E3)}})}})});