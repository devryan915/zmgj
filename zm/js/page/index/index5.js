define(["app","mui","vue"],function(a,e,p){var f=document.getElementById("header"),k=document.getElementById("pr"),g="windex";new p({el:"#pr",data:{ui:{content:document.getElementById("pr"),show:function(){this.content.classList.remove("mui-hidden")},hide:function(){this.content.classList.add("mui-hidden")}},par:{lastDT:a.User.get().LastDT},menus:{windex:{href:"",header:""},wme_me:{href:"../me/me.html",header:'\x3ch1 class\x3d"mui-title"\x3e\u6211\u7684\x3c/h1\x3e'},wequestrian_list:{href:"../equestrian/list.html",header:'\x3ch1 class\x3d"mui-title"\x3e\u897f\u90e8\u9a6c\u672f\x3c/h1\x3e'},wclub_list:{href:"../club/list.html",header:'\x3ch1 class\x3d"mui-title"\x3e\u5929\u9a6c\u4ff1\u4e50\u90e8\u8054\u76df\x3c/h1\x3e'}},o:null,user:a.User.get()},methods:{load:function(){var d=this;a.post("api/News/GetFirstPage",d.par,function(b){JSON.stringify(d.o)!=JSON.stringify(b)&&(d.o=b,a.Cache.setObject(a.Cache.key.cindexData.toKeyName(),d.o),a.loadImg());b.UserInfo&&a.User.set(b.UserInfo);e("#slider").slider({interval:5E3});d.ui.show();a.closeWaiting()},function(){d.o||a.showError(function(){d.ui.hide();a.showWaiting(1);d.load()},1);a.closeWaiting()})},newsMore:function(){e.openWindow({id:"wNewsList",url:"../news/list.html",waiting:{autoShow:!1},styles:{popGesture:"hide"}})},initIndex:function(){plus.screen.lockOrientation("portrait");plus.navigator.closeSplashscreen();plus.navigator.setStatusBarStyle("UIStatusBarStyleBlackOpaque");plus.navigator.setStatusBarBackground("#282828")},loadMenu:function(){var d=this,b=plus.webview.currentWebview(),c={top:"0px",bottom:"50px",render:"always"},l;for(l in d.menus){var n=d.menus[l],h;n.header.length&&(c.top="44px",h=plus.webview.create(n.href,l,c),h.hide(),b.append(h))}d.user.UserID||e.preload({url:"../login/login.html",id:"wlogin",styles:{popGesture:"hide"}});e("#nav").on("touchend","a",function(b){b.preventDefault();b=this.dataset.id;var e=d.menus[b];if(b&&b!=g)if("wme_me"!=b||d.user.UserID){var c=plus.webview.getWebviewById(b);"windex"==b?(f.classList.add("mui-hidden"),k.classList.remove("mui-hidden"),plus.webview.hide(g)):(f.classList.remove("mui-hidden"),k.classList.add("mui-hidden"),c.show("fade-in",200,function(){f.innerHTML=e.header;f.dataset.href=e.href}),g&&plus.webview.hide(g));g=b;c=document.querySelector("#nav a.mui-active");b=document.querySelector("#nav a[data-id\x3d'"+b+"']");b!==c&&(c.classList.remove("mui-active"),b.classList.add("mui-active"))}else a.showLogin(),f.dataset.id=b,a.Cache.set("gotab",!0);return!1});window.addEventListener("gotab",function(b){d.user="userInfo"==b.detail.type&&a.User.get();e.fire(plus.webview.getWebviewById("wme_me"),"reload",{type:"userInfo"});b=void 0!=b.detail.id?b.detail.id:f.dataset.id;f.dataset.id=b;var c=d.menus[b],h=plus.webview.getWebviewById(b);"windex"==b?(f.classList.add("mui-hidden"),k.classList.remove("mui-hidden"),plus.webview.hide(g)):(f.classList.remove("mui-hidden"),k.classList.add("mui-hidden"),h.show("fade-in",200,function(){f.innerHTML=c.header;f.dataset.href=c.href;plus.webview.hide(g)}));g=b;h=document.querySelector("#nav a.mui-active");b=document.querySelector("#nav a[data-id\x3d'"+b+"']");b!==h&&(h&&h.classList.remove("mui-active"),b.classList.add("mui-active"))});setTimeout(function(){d.initIndex()},200);var m=0;e.back=function(b){m++;1<m?plus.runtime.quit():plus.nativeUI.toast("\u518d\u6309\u4e00\u6b21\u9000\u51fa\u5e94\u7528");setTimeout(function(){m=0},1E3);return!1}},addEquestrian:function(){e.openWindow({id:"wequestrian_about",url:"../equestrian/about.html",waiting:{autoShow:!1}})},getVersionNum:function(a){if(null==a||""==a)return 0;a=a.split(".");return 1E5*a[0]+1E3*a[1]+1*a[2]},pushMsg:function(a){var b=a.payload;"string"==typeof a.payload&&(b=JSON.parse(a.payload));switch(b.type){case "openWindow":var c=plus.webview.getWebviewById(b.id);c?(e.fire(c,"reload",{ref:b.ref}),c.show("slide-in-right")):(c=e.preload({id:b.id,url:b.href,styles:{popGesture:"hide"},extras:{ref:b.ref}}),c.show("slide-in-right"),c.addEventListener("hide",function(){e.fire(c,"unload",{})}))}},getVer:function(){var d=this;a.post("api/Common/GetSUI",{verType:a.appType},function(b){var c=d.getVersionNum(a.version),f=d.getVersionNum(b.MinVer),g=d.getVersionNum(b.MaxVer);0!=g&&(b.Remark.replace(RegExp("\x3cbr/\x3e","g"),"\r\n"),g>c&&(c>=f?a.down(b.AddPath,a.upFile,function(c){a.Cache.set(a.Cache.key.isUpFile.toKeyName(),!0);3==a.appType||e.toast(b.MaxVer+" \u66f4\u65b0\u4e0b\u8f7d\u6210\u529f\uff0c\u91cd\u542fapp\u540e\u5b89\u88c5\u66f4\u65b0")}):"Android"==plus.os.name?plus.networkinfo.getCurrentType()==plus.networkinfo.CONNECTION_WIFI?e.alert("\u5f53\u524d\u7248\u672c\u4f4e\u4e8e\u6700\u5c0f\u8fd0\u884c\u7248\u672c\uff0c\u5fc5\u987b\u66f4\u65b0\u540e\u4f7f\u7528\r\n","\u66f4\u65b0\u63d0\u793a",function(){a.down(b.ApkPath,a.appFile,function(a){plus.runtime.openFile(a.filename)})}):e.confirm("\u5f53\u524d\u7248\u672c\u4f4e\u4e8e\u6700\u5c0f\u8fd0\u884c\u7248\u672c\uff0c\u5fc5\u987b\u66f4\u65b0\u540e\u4f7f\u7528\r\n",c+" \u65b0\u7248\u53d1\u5e03",["\u66f4\u65b0","\u53d6\u6d88"],function(c){0==c.index?a.down(b.ApkPath,a.appFile,function(a){plus.runtime.openFile(a.filename)}):plus.runtime.quit()}):"iOS"==plus.os.name&&(b.AppPath?e.alert("\u5f53\u524d\u7248\u672c\u4f4e\u4e8e\u6700\u5c0f\u8fd0\u884c\u7248\u672c\uff0c\u5fc5\u987b\u66f4\u65b0\u540e\u4f7f\u7528\r\n","\u66f4\u65b0\u63d0\u793a",function(){plus.runtime.openURL(b.AppPath)}):e.alert("\u5f53\u524d\u7248\u672c\u4f4e\u4e8e\u6700\u5c0f\u8fd0\u884c\u7248\u672c\uff0c\u5fc5\u987b\u66f4\u65b0\u540e\u4f7f\u7528\r\n","\u66f4\u65b0\u63d0\u793a",function(){a.down(b.AddPath,a.upFile,function(c){plus.runtime.install(a.upFile,{force:!0},function(){a.version=b.MaxVer;a.Cache.set(a.Cache.key.upFileVer.toKeyName(),b.MaxVer);a.Cache.set(a.Cache.key.isUpFile.toKeyName(),!1);a.Cache.set(a.Cache.key.isRestartOpen.toKeyName(),!0);a.log("\u5b89\u88c5\u66f4\u65b0\u6210\u529f");plus.runtime.restart()},function(b){a.log("\u5b89\u88c5\u66f4\u65b0\u5931\u8d25")})})}))))})}},created:function(){(this.o=a.Cache.getObject(a.Cache.key.cindexData.toKeyName()))||a.showWaiting(1);a.loadImg();this.ui.show();this.o&&a.showWaiting()},ready:function(){var d=this;e.init();e.ready(function(){e(".mui-scroll-wrapper").scroll();window.addEventListener("reload",function(b){"userInfo"==b.detail.type&&(d.user=a.User.get(),e.fire(plus.webview.getWebviewById("windex2"),"reload",{type:"userInfo"}))})});e.plusReady(function(){a.log("\u68c0\u67e5\u662f\u5426\u6709\u66f4\u65b0\uff1a"+a.Cache.getBoolean(a.Cache.key.isUpFile.toKeyName())+"|"+a.Cache.getBoolean(a.Cache.key.isRestartOpen.toKeyName()));a.Cache.getBoolean(a.Cache.key.isUpFile.toKeyName())?plus.runtime.install(a.upFile,{force:!1},function(){a.version=a.Cache.getString(a.Cache.key.upFileVer.toKeyName());a.Cache.set(a.Cache.key.isUpFile.toKeyName(),!1);a.Cache.set(a.Cache.key.isRestartOpen.toKeyName(),!0);a.log("\u5b89\u88c5\u66f4\u65b0\u6210\u529f");plus.runtime.restart()},function(b){a.log("\u5b89\u88c5\u66f4\u65b0\u5931\u8d25")}):(d.loadMenu(),d.load(),e(".nav").on("tap",'img[data-id^\x3d"w"]',function(){var a=this.dataset.data?JSON.parse(this.dataset.data):{},c=plus.webview.getWebviewById(this.dataset.id);c?(e.fire(c,"reload",{ref:a}),c.show("slide-in-right")):(c=e.preload({id:this.dataset.id,url:this.dataset.href,styles:{popGesture:"hide"},extras:{ref:a}}),c.show("slide-in-right"),c.addEventListener("hide",function(){e.fire(c,"unload",{})}))}),plus.push.addEventListener("click",function(a){alert("click:::\u63a5\u6536\u6d88\u606f:::"+JSON.stringify(a));d.pushMsg(a)},!1),plus.push.addEventListener("receive",function(a){a.aps?alert("\u63a5\u6536\u5230\u5728\u7ebfAPNS\u6d88\u606f:::"+JSON.stringify(a)):alert("\u63a5\u6536\u5230\u5728\u7ebf\u900f\u4f20\u6d88\u606f:::"+JSON.stringify(a));d.pushMsg(a)},!1),a.Cache.getBoolean(a.Cache.key.isRestartOpen.toKeyName())?a.Cache.set(a.Cache.key.isRestartOpen.toKeyName(),!1):setTimeout(function(){d.getVer()},2E3))})}})});