define(["app","mui","vue"],function(d,b,f){var e=new f({el:"#app",data:{par:{eventId:"",pageIndex:0,pageSize:8},isUp:!0,pageCount:0,list:[],parReview:{eventId:"",content:""},ui:{h:document.getElementById("h"),txtAsk:document.getElementById("txtAsk"),footer:document.getElementById("footer"),content:document.querySelector(".mui-content"),txtFocus:function(){this.txtAsk.focus();setTimeout(function(){this.txtAsk.focus()},150);this.h.style.width=this.txtAsk.offsetWidth+"px"},show:function(){this.content.classList.remove("mui-hidden")},hide:function(){this.content.classList.add("mui-hidden");e.list=[];b("#pr").pullRefresh().refresh(!0);e.parReview.content="";this.txtAsk.value=""}}},computed:{isValid:function(){return!!this.parReview.content}},methods:{load:function(){var a=this;d.post("api/Events/GetDiscussInfo",a.par,function(c){a.pageCount=c.Total;a.isUp?a.list=a.list.concat(c.Items):(a.list=c.Items,b("#pr").pullRefresh().refresh(!0),b("#pr").pullRefresh().endPulldownToRefresh());b("#pr").pullRefresh().endPullupToRefresh(a.par.pageIndex>=a.pageCount);a.ui.show();d.closeWaiting()},function(){b("#pr").pullRefresh().endPulldownToRefresh();b("#pr").pullRefresh().endPullupToRefresh(!1)})},review:function(){var a=this;d.showWaiting();a.parReview.eventId=a.par.eventId;d.post("api/Events/Discuss",a.parReview,function(c){c=d.User.get();a.list.unshift({Name:c.NickName,ImgUrl:c.ImgUrl,Date:(new Date).toString().Format("yyyy-MM-dd hh:mm.ss"),Content:a.parReview.content});a.parReview.content="";a.ui.txtAsk.value="";b.trigger(a.ui.txtAsk,"input",null);b.scrollTo(0,100);a.ui.txtAsk.blur();d.closeWaiting()},function(){d.closeWaiting()})}},created:function(){var a=this;b.init({pullRefresh:{container:"#pr",up:{contentrefresh:"\u6b63\u5728\u52a0\u8f7d...",contentnomore:"\u5df2\u52a0\u8f7d\u5168\u90e8",callback:function(){a.par.pageIndex++;a.load()}}},beforeback:function(){a.ui.hide();return!0},gestureConfig:{tap:!0,doubletap:!0,longtap:!0,swipe:!0,drag:!0,hold:!0,release:!0}})},ready:function(){var a=this;b.ready(function(){a.ui.h.style.width=a.ui.txtAsk.offsetWidth+"px";a.ui.footer.addEventListener("tap",function(a){a.stopPropagation()});a.ui.txtAsk.addEventListener("tap",function(b){a.ui.txtFocus()},!1);a.ui.txtAsk.addEventListener("input",function(){a.ui.h.innerText=this.value.replace(RegExp("\n","gm"),"\n-")||"-";a.ui.footer.style.height=a.ui.h.offsetHeight+a.ui.footer.offsetHeight-this.offsetHeight+"px"})});b.plusReady(function(){plus.webview.currentWebview().setStyle({softinputMode:"adjustResize"});window.addEventListener("reload",function(c){d.showWaiting(1);a.par.eventId=c.detail.exId;a.par.pageIndex=0;b("#pr").pullRefresh().pullupLoading()});var c=plus.webview.currentWebview();a.par.eventId=c.exId;setTimeout(function(){b("#pr").pullRefresh().pullupLoading()});c.addEventListener("popGesture",function(b){b.type="end";a.ui.hide()},!1)})}})});